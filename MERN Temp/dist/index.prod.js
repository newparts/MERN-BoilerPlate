"use strict";var express=require("express"),app=express(),mongoose=require("mongoose"),bodyParser=require("body-parser"),cookieParser=require("cookie-parser"),config=require("./config/key"),_require=require("./models/user"),User=_require.User,_require2=require("./middleware/auth"),auth=_require2.auth;mongoose.connect(config.mongoURI,{useNewUrlParser:!0}).then(function(){return console.log("DB connected")}).catch(function(e){return console.error(e)}),app.use(bodyParser.urlencoded({extended:!0})),app.use(bodyParser.json()),app.use(cookieParser()),app.get("/api/user/auth",auth,function(e,s){s.status(200).json({_id:e._id,isAuth:!0,email:e.user.email,name:e.user.name,lastname:e.user.lastname,role:e.user.role})}),app.post("/api/users/register",function(e,r){new User(e.body).save(function(e,s){return e?r.json({succes:!1,err:e}):r.status(200).json({succes:!0,userData:doc})})}),app.post("/api/user/login",function(r,o){User.findOne({email:r.body.email},function(e,s){if(!s)return o.json({loginSuccess:!1,message:"Autentificare esuata"});s.comparePassword(r.body.password,function(e,s){if(!s)return o.json({loginSuccess:!1,message:"Parola gresita"})}),s.generateToken(function(e,s){if(e)return o.status(400).send(e);o.cookie("x_auth",s.token).status(200).json({loginSuccess:!0})})})}),app.get("/api/user/logout",auth,function(e,r){User.findOneAndUpdate({_id:e.user._id},{token:""},function(e,s){return e?r.json({success:!1,err:e}):r.status(200).send({success:!0})})}),app.listen(5013);